alter table rental add rental_state number;



create or REPLACE view v_his
as
select (select ct.email
        from customer ct
        where ct.licensenumber=rt.licensenumber) 이메일
        ,(select ct.name
        from customer ct
        where ct.licensenumber=rt.licensenumber) 이름
        ,rt.rentalnumber 대여번호
        ,rt.rentalstart 대여일
        ,rt.rentalend 반납일
        ,cr.campcarname 대여차량
        ,cr.campcarnumber 차량번호
        ,(select ccp.compname
        from campcompany ccp
        where ccp.compid=cr.compid) 대여사
        ,(select ccp.compcall
        from campcompany ccp
        where ccp.compid=cr.compid) 대여사연락처
        ,(select ccp.compmanager
        from campcompany ccp
        where ccp.compid=cr.compid) 매니저
        ,rt.rentalcost 대여비용
        ,rt.RENTALETCCOST 기타비용
        ,rt.rentalpaydate 납입기한
         ,case when rt.rental_state = 0 then '예약'
            when rt.rental_state = 1 then '대여'
            when rt.rental_state = -1 then '반납'
             when rt.rental_state = 2 then '취소요청'
              when rt.rental_state = -2 then '취소'
            end 예약상태
    
from rental rt, campingcar cr
where rt.campcarid=cr.campcarid
order by rt.rentalnumber;


select * from v_his;


select * from rental;

select r.campcarid,r.rentalnumber,c.campcarname 
from rental r,campingcar c 
where c.campcarid = r.campcarid and licensenumber = '15-123552-12' and r.rental_state = 1;


select * from repairrequest;
alter table repairrequest add repair_state number default 0 not null;

===================================================


create or replace view v_repair
as
select r_if.repairrequest_num 정비번호
    ,r_if.repairdate 예약날짜
    ,(select cp.campcarnumber
    from campingcar cp
    where cp.campcarid=rt.campcarid) 차량번호
    ,(select cp.campcarname
    from campingcar cp
    where cp.campcarid = rt.campcarid) 정비차량
    ,(select ct.name
    from customer ct
    where ct.licensenumber=rt.licensenumber) 의뢰고객
    ,(select rs.repairshopname
    from repairshop rs
    where rs.repairshopid=r_if.repairshopid) 정비소
    ,concat(concat(r_if.repairhistory,'|'),r_if.repairetchistory) 정비내용
    ,(select rs.repairshopcall
    from repairshop rs
    where rs.repairshopid=r_if.repairshopid) 전화번호
    , r_if.repaircost 정비비용
    ,r_if.repairpaydate 납입기한
    ,(select email
    from customer ct
    where ct.licensenumber = rt.licensenumber)이메일
    ,case when r_if.repair_state = 0 then '예약'
        when r_if.repair_state = 1 then '요청대기'
        when r_if.repair_state = 2 then '승인'
        when r_if.repair_state = -1 then '취소'
    end 상태
    
from repairrequest r_if,rental rt
where r_if.rentalnumber=rt.rentalnumber;

select * from v_repair;

select * from repairrequest;


<<<<<<< HEAD



alter table campcompany
add primary key (compid);


alter table campingcar
add primary key (campcarid);



alter table customer
add primary key (licensenumber);


alter table customer_info
add primary key (customer_info);


alter table rental
add primary key (rentalnumber);


alter table repairinfo
add primary key (repairinfo_num);



alter table repairrequest
add primary key (repairrequest_num);



alter table repairshop
add primary key (repairshopid);
=======
=========================================================================

create or replace view v_repairinfo
as
select r_if.repairrequest_num 정비번호
    ,r_if.repairdate 예약날짜
    ,(select cp.campcarnumber
    from campingcar cp
    where cp.campcarid=rt.campcarid) 차량번호
    ,(select cp.campcarname
    from campingcar cp
    where cp.campcarid = rt.campcarid) 정비차량
    ,(select ct.name
    from customer ct
    where ct.licensenumber=rt.licensenumber) 의뢰고객
    ,(select rs.repairshopname
    from repairshop rs
    where rs.repairshopid=r_if.repairshopid) 정비소
    ,concat(concat(r_if.repairhistory,'|'),r_if.repairetchistory) 정비내용
    ,(select rs.repairshopcall
    from repairshop rs
    where rs.repairshopid=r_if.repairshopid) 전화번호
    , r_if.repaircost 정비비용
    ,r_if.repairpaydate 납입기한
    ,(select email
    from customer ct
    where ct.licensenumber = rt.licensenumber)이메일
    ,case when r_if.repair_state = 0 then '예약'
        when r_if.repair_state = 1 then '요청대기'
        when r_if.repair_state = 2 then '승인'
        when r_if.repair_state = -1 then '취소'
    end 상태
    
from repairrequest r_if,rental rt, repairinfo rif
where r_if.rentalnumber=rt.rentalnumber and rif.repairrequest_num=r_if.repairrequest_num;
>>>>>>> 62aa4eec3141fa750807115795a90bacd6e9a433

<<<<<<< HEAD


CREATE SEQUENCE CUSTOMER_INFO_NUM
       INCREMENT BY 1
       START WITH 1
       MINVALUE 1
       MAXVALUE 9999
       NOCYCLE
       NOCACHE
       NOORDER;
=======
=======================================================================
--캠핑카 제약조건
ALTER TABLE campingcar
ADD CONSTRAINTS company_id FOREIGN KEY (compid) 
REFERENCES campcompany(compid);

--대여 제약조건
ALTER TABLE rental
ADD CONSTRAINTS customer FOREIGN KEY (LICENSENUMBER) 
REFERENCES customer(LICENSENUMBER);

ALTER TABLE rental
ADD CONSTRAINTS campingcar_id FOREIGN KEY (campcarid) 
REFERENCES campingcar(campcarid);

--정비의뢰 제약조건
ALTER TABLE repairrequest
ADD CONSTRAINTS rental_num FOREIGN KEY (rentalnumber) 
REFERENCES rental(rentalnumber);

ALTER TABLE repairrequest
ADD CONSTRAINTS repairshot_id FOREIGN KEY (REPAIRSHOPID) 
REFERENCES repairshop(REPAIRSHOPID);

--정비정보 제약조건
ALTER TABLE repairinfo
ADD CONSTRAINTS request_num FOREIGN KEY (REPAIRREQUEST_NUM) 
REFERENCES repairrequest(REPAIRREQUEST_NUM);

--고객이용이력 제약조건

ALTER TABLE customer_info
ADD CONSTRAINTS custRental_num FOREIGN KEY (rentalnumber) 
REFERENCES rental(rentalnumber);

ALTER TABLE customer_info
ADD CONSTRAINTS custLicense_num FOREIGN KEY (licensenumber) 
REFERENCES customer(licensenumber);
>>>>>>> a51ac65bfbe1318a0bc117f2c705bbed4ed1a942
